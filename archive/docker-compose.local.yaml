# # # docker-compose.yml (updated)
# # version: '3.8'

# # services:
# #   mongodb:
# #     image: mongo:6.0
# #     container_name: mlflow-mongodb
# #     restart: unless-stopped
# #     ports:
# #       - "27017:27017"
# #     environment:
# #       MONGO_INITDB_ROOT_USERNAME: ${MONGO_USER:-admin}
# #       MONGO_INITDB_ROOT_PASSWORD: ${MONGO_PASSWORD:-admin123}
# #       MONGO_INITDB_DATABASE: ${MONGO_DB:-mlflow}
# #     volumes:
# #       - mongodb_data:/data/db
# #     healthcheck:
# #       test: ["CMD", "mongosh", "--eval", "db.adminCommand('ping')"]
# #       interval: 30s
# #       timeout: 10s
# #       retries: 3

# #   mlflow-init:
# #     build: .
# #     container_name: mlflow-init
# #     depends_on:
# #       mongodb:
# #         condition: service_healthy
# #     environment:
# #       - MONGO_URI=mongodb://${MONGO_USER:-admin}:${MONGO_PASSWORD:-admin123}@mongodb:27017
# #       - MONGO_DB=${MONGO_DB:-mlflow}
# #     command: python scripts/init_mongo.py
# #     profiles:
# #       - init

# #   mlflow:
# #     build: .
# #     container_name: mlflow-server
# #     restart: unless-stopped
# #     ports:
# #       - "5000:5000"
# #     environment:
# #       - MLFLOW_BACKEND_STORE_URI=mongodb://${MONGO_USER:-admin}:${MONGO_PASSWORD:-admin123}@mongodb:27017/${MONGO_DB:-mlflow}?retryWrites=true&w=majority
# #       - MLFLOW_ARTIFACT_STORE_URI=${MLFLOW_ARTIFACT_STORE_URI}
# #       - MLFLOW_HOST=0.0.0.0
# #       - MLFLOW_PORT=5000
# #       - MLFLOW_WORKERS=4
# #     depends_on:
# #       - mongodb
# #     volumes:
# #       - ./mlflow:/app/mlflow
# #       - ./examples:/app/examples

# # volumes:
# #   mongodb_data:



# # production
# # docker-compose.prod.yml
# # docker-compose.local.yml
# version: '3.8'

# services:
#   # MongoDB
#   mongodb:
#     image: mongo:6.0
#     container_name: mlflow-mongodb-local
#     restart: unless-stopped
#     ports:
#       - "27017:27017"
#     environment:
#       MONGO_INITDB_ROOT_USERNAME: admin
#       MONGO_INITDB_ROOT_PASSWORD: admin123
#       MONGO_INITDB_DATABASE: mlflow
#     volumes:
#       - mongodb_data:/data/db
#       - ./scripts/init_mongo.js:/docker-entrypoint-initdb.d/init-mongo.js:ro
#     command: mongod --replSet rs0 --bind_ip_all
#     healthcheck:
#       test: ["CMD", "mongosh", "--eval", "db.adminCommand('ping')"]
#       interval: 30s
#       timeout: 10s
#       retries: 3

#   # MinIO
#   minio:
#     image: minio/minio:latest
#     container_name: mlflow-minio-local
#     restart: unless-stopped
#     ports:
#       - "9000:9000"
#       - "9001:9001"
#     environment:
#       MINIO_ROOT_USER: minioadmin
#       MINIO_ROOT_PASSWORD: minioadmin123
#       MINIO_BROWSER: "on"
#     volumes:
#       - minio_data:/data
#     command: server /data --console-address ":9001"
#     healthcheck:
#       test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
#       interval: 30s
#       timeout: 20s
#       retries: 3

#   # MLflow Server
#   mlflow:
#     build: .
#     container_name: mlflow-server-local
#     restart: unless-stopped
#     ports:
#       - "5000:5000"
#     environment:
#       # MongoDB
#       - MONGO_SERVICE_NAME=mlflow-mongodb
#       - MONGO_HOST=mongodb
#       - MONGO_PORT=27017
#       - MONGO_USER=mlflow
#       - MONGO_PASSWORD=mlflow123
#       - MONGO_DB=mlflow
      
#       # MinIO
#       - MINIO_SERVICE_NAME=mlflow-minio
#       - MINIO_HOST=minio
#       - MINIO_PORT=9000
#       - MINIO_CONSOLE_PORT=9001
#       - MINIO_ACCESS_KEY=minioadmin
#       - MINIO_SECRET_KEY=minioadmin123
#       - MINIO_BUCKET=mlflow-artifacts
#       - MINIO_SECURE=false
#       - MINIO_REGION=us-east-1
      
#       # Server
#       - MLFLOW_HOST=0.0.0.0
#       - MLFLOW_PORT=5000
#       - MLFLOW_WORKERS=2
#       - MLFLOW_TIMEOUT=120
#       - MLFLOW_SERVE_ARTIFACTS=true
      
#       # App
#       - LOG_LEVEL=INFO
#       - DEBUG=true
#       - PYTHONUNBUFFERED=1
#       - RENDER=false
      
#       # AWS SDK
#       - AWS_ACCESS_KEY_ID=minioadmin
#       - AWS_SECRET_ACCESS_KEY=minioadmin123
#       - AWS_DEFAULT_REGION=us-east-1
#     volumes:
#       - ./logs:/app/logs
#       - ./cache:/app/cache
#       - .:/app
#     depends_on:
#       mongodb:
#         condition: service_healthy
#       minio:
#         condition: service_healthy
#     command: >
#       sh -c "
#         echo 'Initializing services...' &&
#         python scripts/init_mongo.py &&
#         python scripts/init_minio.py &&
#         echo 'Starting MLflow server...' &&
#         python mlflow/server.py
#       "
#     healthcheck:
#       test: ["CMD", "python", "scripts/health_check.py"]
#       interval: 30s
#       timeout: 10s
#       retries: 3
#       start_period: 40s

# volumes:
#   mongodb_data:
#   minio_data: